# AWS S3

## 1.  Amazon S3 개념 및 핵심 기능
---
### 🎯 개요

- *Amazon S3 (Simple Storage Service)*는 AWS에서 제공하는 **객체 기반 스토리지 서비스**로, **무제한 확장 가능**하며 _고가용성_과 _내구성_을 제공합니다.
- **정적 웹사이트 호스팅**, **백업**, **아카이브**, **데이터 분석** 등 다양한 목적으로 활용됩니다.

---

### 📌 1. 주요 사용 사례

- **백업 및 복구**: 재해 복구를 위한 _리전 간 데이터 복사_
- **아카이브 저장소**: 장기 보관용으로 _저렴한 요금제(S3 Glacier)_ 활용
- **정적 웹사이트 호스팅**: HTML, CSS, JS 파일을 업로드해 바로 웹 제공
- **데이터 레이크**: _빅데이터 분석_을 위한 원시 데이터 저장
- **소프트웨어 배포**: 앱 설치 파일이나 업데이트 파일 저장

---

### 🧱 2. S3 구성 요소

#### 🪣 버킷 (Bucket)

- _S3에서 파일을 저장하는 최상위 컨테이너_
- **전역에서 고유한 이름**을 가져야 함
- 특정 **리전 단위로 생성**됨 (예: `ap-northeast-2`)
- 작명 규칙:
    - 대문자 ❌, 언더바 `_` ❌
    - 3~63자, IP 형식 ❌
    - 소문자 또는 숫자로 시작 가능
    - `-`(하이픈)은 허용

#### 📁 오브젝트 (Object)

- _버킷 안에 저장되는 개별 파일_
- 각 오브젝트는 **Key(키)**로 식별됨
    - `my_file.txt`
    - `folder1/images/logo.png` ← 전체 경로가 Key
- S3는 **디렉토리 개념이 없으며**, _키의 경로를 기반으로 계층처럼 표시함_
- **최대 5TB까지 업로드 가능**
    - 5GB 초과 시 → **멀티파트 업로드** 사용

#### 🏷️ 메타데이터 & 태그

- **메타데이터**: 오브젝트의 속성을 설명하는 _key-value 쌍_
    - 예: `Content-Type`, `Last-Modified`
- **태그(Tag)**: 최대 10개의 _커스텀 키-값_ 설정 가능
    - 예: `project = data-lake`
    - _보안 정책_, _수명 주기 관리_에 유용

#### 📌 버전 관리 (Versioning)

- 활성화하면 **동일한 파일명 업로드 시 버전이 생성됨**
- 삭제 방지, 복구 등 _데이터 보호_에 효과적

---

### 📝 정리

|항목|설명|
|---|---|
|버킷|_전역 고유 이름_, 리전 단위로 생성|
|오브젝트|_Key_로 구분, 폴더 아님 (`/`는 단지 키의 일부)|
|크기 제한|최대 **5TB**, 5GB 초과 시 멀티파트 업로드|
|메타데이터|_속성 정의_, 태그는 최대 10개|
|버전 관리|_데이터 변경 이력 추적_ 및 복구 지원|

---

## 2. Amazon S3 버킷 생성 및 객체 업로드 실습
---

### 🪣 버킷 생성 과정

- **버킷 위치(리전)** 선택: 예) _유럽 스톡홀름_ (`eu-north-1`)
    
    > S3는 _글로벌 서비스_처럼 보이지만, **버킷은 특정 리전에 속함**
    
- **버킷 유형**:
    
    - _"범용 (General-purpose)"_ 선택
    - "디렉토리 버킷"은 특정 사용 사례용 → 시험 범위 아님
    - 보이지 않아도 자동 적용되므로 걱정 ❌
- **버킷 이름**:
    
    - 전역에서 **고유**해야 함 (모든 계정 + 모든 리전 대상)
    - 예: `stefan-demo-s3-v5`
    - 일반 단어(`test`) 사용 시 충돌 발생 가능
- **기본 설정 유지 항목**:
    
    - **객체 소유권**: _ACL 비활성화 (권장)_
    - **공개 액세스 차단**: _활성화 (보안 유지)_
    - **버전 관리**: _비활성화 (나중에 설정 가능)_
    - **암호화**: _Amazon S3 관리형 키(SSE-S3)_
    - **버킷 키**: _활성화_
- 마지막에 **[Create bucket]** 클릭 → 생성 완료
    

---

### ☁️ 객체 업로드

1. **업로드 대상**: `coffee.jpg`
    
    - 위치: 루트 버킷 `s3://stefan-demo-s3`
    - 크기: _100KB JPEG 이미지_
    - UI에서 **업로드 → 파일 선택 → 업로드 완료**
2. **업로드 확인**:
    
    - 업로드한 객체는 **객체 리스트**에 나타남
    - 클릭 시 상세 정보 확인 가능:
        - 파일 유형, 크기, _객체 URL_

---

### 🔒 객체 접근과 URL

- **객체 URL** 클릭 → `Access Denied` 발생
- 이유: _공개 액세스 차단 설정_ 때문

#### 🔐 _미리 서명된 URL (Pre-signed URL)_

- AWS가 **임시로 접근 가능한 URL**을 생성
- 포함 정보:
    - _요청자의 인증 정보_
    - _유효 기간_
- S3는 해당 사용자의 요청이 **유효함을 검증**하고 객체 제공

> `공개 URL`은 실패, `미리 서명된 URL`은 성공 → 보안 기반 차이

---

### 📁 폴더 생성 및 내부 업로드

1. **폴더 생성**:
    
    - 이름: `images`
    - 생성 후 클릭 가능 (실제 디렉토리는 아니고 _키 접두사 기반 구조_)
2. **폴더 내부 업로드**:
    
    - 업로드할 파일: `beach.jpg`
    - 경로: `s3://stefan-demo-s3/images/beach.jpg`
    - 업로드 후 **폴더 내부 객체로 표시됨**
3. **삭제**:
    
    - 폴더 전체 삭제 시 내부 객체도 삭제됨
    - **"permanently delete"** 입력 후 삭제 진행

---

### 📝 핵심 정리

|항목|내용|
|---|---|
|**버킷 이름**|_전역 고유_, 모든 AWS 계정/리전 간 충돌 없어야 함|
|**버킷 리전**|_생성 시 지정_, 이후 변경 불가|
|**접근 권한**|기본적으로 _모든 공개 접근 차단_, 직접 허용하거나 서명된 URL 필요|
|**폴더 구조**|실제 디렉토리 아님 → *키 접두사(prefix)*로 표현됨|
|**파일 업로드 제한**|최대 _5TB_, 5GB 초과는 _멀티파트 업로드_ 필수|
|**미리 서명된 URL**|_일시적 액세스_ 허용, 자격 증명 포함되어 있어 보안 유지 가능|

---

## 3. S3 보안 : 버킷정책
---

### 🔐 핵심 개념

Amazon S3 보안은 _사용자 기반_과 _리소스 기반_으로 구성되며, 대표적으로 다음과 같은 요소로 관리됩니다:

- **IAM 정책**
- **S3 버킷 정책**
- **ACL (Access Control List)**
- **암호화**
- **퍼블릭 액세스 차단 설정**

---

### 👤 사용자 기반 접근 제어 – IAM 정책

- **IAM 정책**은 _특정 사용자_가 _어떤 API_를 호출할 수 있는지를 정의
    
- 사용자의 **권한 부여**는 아래 두 조건을 만족해야 함:
    
    1. 정책에 **허용(`Allow`)**이 명시되어 있음
    2. **명시적 거부(`Deny`)**가 없어야 함
- EC2 인스턴스에서 S3에 접근할 경우:
    
    - **IAM 사용자 ❌**
    - **IAM 역할(Instance Role) ✅**

---

### 🗂️ 리소스 기반 접근 제어 – S3 버킷 정책

- **버킷 정책**은 S3 버킷 자체에 직접 연결되는 _JSON 형식의 정책_
    
- 버킷 정책 구조 예시:
    
    ```json
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::examplebucket/*"
    }
    ```
    
    - `Effect`: _허용(Allow)_ 또는 _거부(Deny)_
    - `Principal`: `*`이면 _모든 사용자_를 의미
    - `Action`: 허용할 API 액션 (예: `s3:GetObject`)
    - `Resource`: 대상 버킷/오브젝트 (`*` 사용 시 전체 오브젝트)
- 위 예시는:  
    → **모든 사용자에게 examplebucket의 모든 오브젝트 읽기(GetObject)를 허용**
    

---

### 🌍 퍼블릭 액세스 관련 설정

- **퍼블릭 접근 허용 시 주의할 점**
    - 버킷 정책에서 `Principal: "*"`로 설정해도, 퍼블릭 차단 설정이 켜져 있으면 **공개 불가**
    - _S3 콘솔에서 설정하는 퍼블릭 액세스 차단 옵션_은 **우선순위가 가장 높음**
        - 기업 데이터 유출 방지 목적
        - _계정 단위로도 활성화 가능_

---

### ⚙️ 고급 기능: 교차 계정 액세스 (Cross-account Access)

- 다른 AWS 계정의 IAM 사용자에게 _S3 버킷 접근 허용_ 가능
- 방법:
    1. **버킷 정책**에 _해당 사용자 ARN_을 명시
    2. 액션과 리소스를 정의해 해당 사용자만 호출 가능하게 설정

---

### 🧱 보안 계층 요약

|보안 방법|설명|
|---|---|
|**IAM 정책**|사용자/역할에게 _API 호출 권한_을 부여|
|**S3 버킷 정책**|버킷 또는 오브젝트 단위의 _리소스 기반 접근 제어_|
|**ACL**|_레거시 방식_, 세부 접근 제어 가능 (현재는 비활성화 권장)|
|**퍼블릭 액세스 차단**|실수 방지를 위한 _강제 보호 장치_, 계정 또는 버킷 단위로 설정 가능|
|**암호화**|저장된 오브젝트를 _자동으로 암호화_, SSE-S3, SSE-KMS 등 사용 가능|

---

### 💡 실전 팁

- `Principal: "*"` 는 위험 요소 → 반드시 제한적 사용
- 퍼블릭 액세스를 열기 전에:
    - _정책_, _퍼블릭 차단 설정_, _IAM 권한_을 모두 점검할 것
- IAM 역할을 통해 EC2에서 안전하게 S3 접근 가능
- 보안 강화를 위해:
    - _퍼블릭 차단 설정_은 항상 활성화
    - _버킷 정책 검토_ 및 _암호화 사용_ 필수

---

## 4. 
---
