# AWS S3

## 1.  Amazon S3 개념 및 핵심 기능
---
### 🎯 개요

- *Amazon S3 (Simple Storage Service)*는 AWS에서 제공하는 **객체 기반 스토리지 서비스**로, **무제한 확장 가능**하며 _고가용성_과 _내구성_을 제공합니다.
- **정적 웹사이트 호스팅**, **백업**, **아카이브**, **데이터 분석** 등 다양한 목적으로 활용됩니다.

---

### 📌 1. 주요 사용 사례

- **백업 및 복구**: 재해 복구를 위한 _리전 간 데이터 복사_
- **아카이브 저장소**: 장기 보관용으로 _저렴한 요금제(S3 Glacier)_ 활용
- **정적 웹사이트 호스팅**: HTML, CSS, JS 파일을 업로드해 바로 웹 제공
- **데이터 레이크**: _빅데이터 분석_을 위한 원시 데이터 저장
- **소프트웨어 배포**: 앱 설치 파일이나 업데이트 파일 저장

---

### 🧱 2. S3 구성 요소

#### 🪣 버킷 (Bucket)

- _S3에서 파일을 저장하는 최상위 컨테이너_
- **전역에서 고유한 이름**을 가져야 함
- 특정 **리전 단위로 생성**됨 (예: `ap-northeast-2`)
- 작명 규칙:
    - 대문자 ❌, 언더바 `_` ❌
    - 3~63자, IP 형식 ❌
    - 소문자 또는 숫자로 시작 가능
    - `-`(하이픈)은 허용

#### 📁 오브젝트 (Object)

- _버킷 안에 저장되는 개별 파일_
- 각 오브젝트는 **Key(키)**로 식별됨
    - `my_file.txt`
    - `folder1/images/logo.png` ← 전체 경로가 Key
- S3는 **디렉토리 개념이 없으며**, _키의 경로를 기반으로 계층처럼 표시함_
- **최대 5TB까지 업로드 가능**
    - 5GB 초과 시 → **멀티파트 업로드** 사용

#### 🏷️ 메타데이터 & 태그

- **메타데이터**: 오브젝트의 속성을 설명하는 _key-value 쌍_
    - 예: `Content-Type`, `Last-Modified`
- **태그(Tag)**: 최대 10개의 _커스텀 키-값_ 설정 가능
    - 예: `project = data-lake`
    - _보안 정책_, _수명 주기 관리_에 유용

#### 📌 버전 관리 (Versioning)

- 활성화하면 **동일한 파일명 업로드 시 버전이 생성됨**
- 삭제 방지, 복구 등 _데이터 보호_에 효과적

---

### 📝 정리

|항목|설명|
|---|---|
|버킷|_전역 고유 이름_, 리전 단위로 생성|
|오브젝트|_Key_로 구분, 폴더 아님 (`/`는 단지 키의 일부)|
|크기 제한|최대 **5TB**, 5GB 초과 시 멀티파트 업로드|
|메타데이터|_속성 정의_, 태그는 최대 10개|
|버전 관리|_데이터 변경 이력 추적_ 및 복구 지원|

---

## 2. Amazon S3 버킷 생성 및 객체 업로드 실습
---

### 🪣 버킷 생성 과정

- **버킷 위치(리전)** 선택: 예) _유럽 스톡홀름_ (`eu-north-1`)
    
    > S3는 _글로벌 서비스_처럼 보이지만, **버킷은 특정 리전에 속함**
    
- **버킷 유형**:
    
    - _"범용 (General-purpose)"_ 선택
    - "디렉토리 버킷"은 특정 사용 사례용 → 시험 범위 아님
    - 보이지 않아도 자동 적용되므로 걱정 ❌
- **버킷 이름**:
    
    - 전역에서 **고유**해야 함 (모든 계정 + 모든 리전 대상)
    - 예: `stefan-demo-s3-v5`
    - 일반 단어(`test`) 사용 시 충돌 발생 가능
- **기본 설정 유지 항목**:
    
    - **객체 소유권**: _ACL 비활성화 (권장)_
    - **공개 액세스 차단**: _활성화 (보안 유지)_
    - **버전 관리**: _비활성화 (나중에 설정 가능)_
    - **암호화**: _Amazon S3 관리형 키(SSE-S3)_
    - **버킷 키**: _활성화_
- 마지막에 **[Create bucket]** 클릭 → 생성 완료
    

---

### ☁️ 객체 업로드

1. **업로드 대상**: `coffee.jpg`
    
    - 위치: 루트 버킷 `s3://stefan-demo-s3`
    - 크기: _100KB JPEG 이미지_
    - UI에서 **업로드 → 파일 선택 → 업로드 완료**
2. **업로드 확인**:
    
    - 업로드한 객체는 **객체 리스트**에 나타남
    - 클릭 시 상세 정보 확인 가능:
        - 파일 유형, 크기, _객체 URL_

---

### 🔒 객체 접근과 URL

- **객체 URL** 클릭 → `Access Denied` 발생
- 이유: _공개 액세스 차단 설정_ 때문

#### 🔐 _미리 서명된 URL (Pre-signed URL)_

- AWS가 **임시로 접근 가능한 URL**을 생성
- 포함 정보:
    - _요청자의 인증 정보_
    - _유효 기간_
- S3는 해당 사용자의 요청이 **유효함을 검증**하고 객체 제공

> `공개 URL`은 실패, `미리 서명된 URL`은 성공 → 보안 기반 차이

---

### 📁 폴더 생성 및 내부 업로드

1. **폴더 생성**:
    
    - 이름: `images`
    - 생성 후 클릭 가능 (실제 디렉토리는 아니고 _키 접두사 기반 구조_)
2. **폴더 내부 업로드**:
    
    - 업로드할 파일: `beach.jpg`
    - 경로: `s3://stefan-demo-s3/images/beach.jpg`
    - 업로드 후 **폴더 내부 객체로 표시됨**
3. **삭제**:
    
    - 폴더 전체 삭제 시 내부 객체도 삭제됨
    - **"permanently delete"** 입력 후 삭제 진행

---

### 📝 핵심 정리

|항목|내용|
|---|---|
|**버킷 이름**|_전역 고유_, 모든 AWS 계정/리전 간 충돌 없어야 함|
|**버킷 리전**|_생성 시 지정_, 이후 변경 불가|
|**접근 권한**|기본적으로 _모든 공개 접근 차단_, 직접 허용하거나 서명된 URL 필요|
|**폴더 구조**|실제 디렉토리 아님 → *키 접두사(prefix)*로 표현됨|
|**파일 업로드 제한**|최대 _5TB_, 5GB 초과는 _멀티파트 업로드_ 필수|
|**미리 서명된 URL**|_일시적 액세스_ 허용, 자격 증명 포함되어 있어 보안 유지 가능|

---

## 3. S3 보안 : 버킷정책
---

### 🧠 Amazon S3 보안의 핵심 구조

S3 보안은 크게 **사용자 기준 보안(IAM 정책)**과 **리소스 기준 보안(S3 버킷 정책, ACL)**으로 나뉜다.

---

### ✅ 사용자 기준 보안: IAM 정책

💡 **IAM 정책의 역할**

- _어떤 API를 어떤 IAM 사용자 또는 역할이 호출할 수 있는가_를 정의
- 사용자의 권한을 세밀히 제어할 수 있음

💡 **EC2와 IAM 역할**

- EC2 인스턴스가 S3에 접근할 경우 **IAM 사용자 대신 IAM 역할** 사용
- EC2에 역할을 할당하고 S3 접근 권한 포함 시, 인스턴스에서 S3 API 호출 가능

---

### ✅ 리소스 기준 보안

#### 1. 🔐 S3 버킷 정책

- **S3 보안의 중심** 기능
- JSON 형식의 정책 문서로 작성
- S3 콘솔에서 설정 가능

**버킷 정책 구성 요소**

|요소|설명|
|---|---|
|`"Resource"`|정책이 적용될 버킷 또는 오브젝트 경로 (`"arn:aws:s3:::examplebucket/*"` 등)|
|`"Effect"`|`Allow` 또는 `Deny` – 요청 허용/거부|
|`"Action"`|허용 또는 거부할 S3 API 목록 (예: `s3:GetObject`)|
|`"Principal"`|정책이 적용될 사용자, 계정 등 (`"*"`이면 모두 허용)|

💡 **예시 정책 설명**

```json
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::examplebucket/*"
}
```

→ examplebucket에 있는 **모든 오브젝트를 누구나 읽을 수 있도록 허용**  
→ 퍼블릭 접근 설정

🧠 **교차 계정 액세스(Cross-account Access)**

- 다른 AWS 계정의 사용자에게 접근 권한 부여 가능
- 버킷 정책에서 특정 계정의 사용자만 허용하도록 설정 가능

#### 2. 📄 Access Control List (ACL)

- 오래된 방식, 객체 단위까지 세부 권한 설정 가능
- 현재는 **비활성화**하는 경우가 많음
- _버킷 ACL_도 있지만 일반적으로 잘 사용하지 않음

---

### 🔐 S3 오브젝트 암호화

💡 오브젝트 저장 시 암호화 가능

- **SSE (Server-Side Encryption)** 방식
- 자체 키 또는 KMS 키 사용 가능

---

### ⚠️ 퍼블릭 접근 차단 설정

✅ **퍼블릭 접근 차단(Public Access Block)** 기능

- 실수로 퍼블릭 액세스를 허용하지 않도록 보호
- S3 버킷 정책이 퍼블릭이라도 **이 설정이 활성화되면 접근 불가**
- **버킷 단위** 또는 **계정 전체 단위**로 설정 가능

🛡 기업 데이터 유출 방지를 위한 안전 장치  
→ 버킷을 공개할 필요가 없다면 **항상 활성화 추천**

---

### ✅ S3 접근 조건 요약

- 접근 가능 조건:
    - IAM 정책 또는 S3 리소스 정책에서 명시적으로 **Allow**
    - 명시적 **Deny**가 없어야 함

---

### 💡 정리

- S3 보안 = **IAM 정책 + S3 버킷 정책 + ACL (선택적) + 암호화 + 퍼블릭 접근 차단**
- **퍼블릭 접근은 신중히**, 차단 설정을 적극 활용
- **정책 구조와 적용 대상 명확히 이해**하는 것이 핵심

---

👉 실습을 통해 퍼블릭 버킷 설정, IAM 권한 부여, EC2 역할 구성 등을 연습 예정
## 4. 
---
