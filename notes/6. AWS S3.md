# AWS S3

## 1.  Amazon S3 개념 및 핵심 기능
---
### 🎯 개요

- *Amazon S3 (Simple Storage Service)*는 AWS에서 제공하는 **객체 기반 스토리지 서비스**로, **무제한 확장 가능**하며 _고가용성_과 _내구성_을 제공합니다.
- **정적 웹사이트 호스팅**, **백업**, **아카이브**, **데이터 분석** 등 다양한 목적으로 활용됩니다.

---

### 📌 1. 주요 사용 사례

- **백업 및 복구**: 재해 복구를 위한 _리전 간 데이터 복사_
- **아카이브 저장소**: 장기 보관용으로 _저렴한 요금제(S3 Glacier)_ 활용
- **정적 웹사이트 호스팅**: HTML, CSS, JS 파일을 업로드해 바로 웹 제공
- **데이터 레이크**: _빅데이터 분석_을 위한 원시 데이터 저장
- **소프트웨어 배포**: 앱 설치 파일이나 업데이트 파일 저장

---

### 🧱 2. S3 구성 요소

#### 🪣 버킷 (Bucket)

- _S3에서 파일을 저장하는 최상위 컨테이너_
- **전역에서 고유한 이름**을 가져야 함
- 특정 **리전 단위로 생성**됨 (예: `ap-northeast-2`)
- 작명 규칙:
    - 대문자 ❌, 언더바 `_` ❌
    - 3~63자, IP 형식 ❌
    - 소문자 또는 숫자로 시작 가능
    - `-`(하이픈)은 허용

#### 📁 오브젝트 (Object)

- _버킷 안에 저장되는 개별 파일_
- 각 오브젝트는 **Key(키)**로 식별됨
    - `my_file.txt`
    - `folder1/images/logo.png` ← 전체 경로가 Key
- S3는 **디렉토리 개념이 없으며**, _키의 경로를 기반으로 계층처럼 표시함_
- **최대 5TB까지 업로드 가능**
    - 5GB 초과 시 → **멀티파트 업로드** 사용

#### 🏷️ 메타데이터 & 태그

- **메타데이터**: 오브젝트의 속성을 설명하는 _key-value 쌍_
    - 예: `Content-Type`, `Last-Modified`
- **태그(Tag)**: 최대 10개의 _커스텀 키-값_ 설정 가능
    - 예: `project = data-lake`
    - _보안 정책_, _수명 주기 관리_에 유용

#### 📌 버전 관리 (Versioning)

- 활성화하면 **동일한 파일명 업로드 시 버전이 생성됨**
- 삭제 방지, 복구 등 _데이터 보호_에 효과적

---

### 📝 정리

|항목|설명|
|---|---|
|버킷|_전역 고유 이름_, 리전 단위로 생성|
|오브젝트|_Key_로 구분, 폴더 아님 (`/`는 단지 키의 일부)|
|크기 제한|최대 **5TB**, 5GB 초과 시 멀티파트 업로드|
|메타데이터|_속성 정의_, 태그는 최대 10개|
|버전 관리|_데이터 변경 이력 추적_ 및 복구 지원|

---

## 2. Amazon S3 버킷 생성 및 객체 업로드 실습
---

### 🪣 버킷 생성 과정

- **버킷 위치(리전)** 선택: 예) _유럽 스톡홀름_ (`eu-north-1`)
    
    > S3는 _글로벌 서비스_처럼 보이지만, **버킷은 특정 리전에 속함**
    
- **버킷 유형**:
    
    - _"범용 (General-purpose)"_ 선택
    - "디렉토리 버킷"은 특정 사용 사례용 → 시험 범위 아님
    - 보이지 않아도 자동 적용되므로 걱정 ❌
- **버킷 이름**:
    
    - 전역에서 **고유**해야 함 (모든 계정 + 모든 리전 대상)
    - 예: `stefan-demo-s3-v5`
    - 일반 단어(`test`) 사용 시 충돌 발생 가능
- **기본 설정 유지 항목**:
    
    - **객체 소유권**: _ACL 비활성화 (권장)_
    - **공개 액세스 차단**: _활성화 (보안 유지)_
    - **버전 관리**: _비활성화 (나중에 설정 가능)_
    - **암호화**: _Amazon S3 관리형 키(SSE-S3)_
    - **버킷 키**: _활성화_
- 마지막에 **[Create bucket]** 클릭 → 생성 완료
    

---

### ☁️ 객체 업로드

1. **업로드 대상**: `coffee.jpg`
    
    - 위치: 루트 버킷 `s3://stefan-demo-s3`
    - 크기: _100KB JPEG 이미지_
    - UI에서 **업로드 → 파일 선택 → 업로드 완료**
2. **업로드 확인**:
    
    - 업로드한 객체는 **객체 리스트**에 나타남
    - 클릭 시 상세 정보 확인 가능:
        - 파일 유형, 크기, _객체 URL_

---

### 🔒 객체 접근과 URL

- **객체 URL** 클릭 → `Access Denied` 발생
- 이유: _공개 액세스 차단 설정_ 때문

#### 🔐 _미리 서명된 URL (Pre-signed URL)_

- AWS가 **임시로 접근 가능한 URL**을 생성
- 포함 정보:
    - _요청자의 인증 정보_
    - _유효 기간_
- S3는 해당 사용자의 요청이 **유효함을 검증**하고 객체 제공

> `공개 URL`은 실패, `미리 서명된 URL`은 성공 → 보안 기반 차이

---

### 📁 폴더 생성 및 내부 업로드

1. **폴더 생성**:
    
    - 이름: `images`
    - 생성 후 클릭 가능 (실제 디렉토리는 아니고 _키 접두사 기반 구조_)
2. **폴더 내부 업로드**:
    
    - 업로드할 파일: `beach.jpg`
    - 경로: `s3://stefan-demo-s3/images/beach.jpg`
    - 업로드 후 **폴더 내부 객체로 표시됨**
3. **삭제**:
    
    - 폴더 전체 삭제 시 내부 객체도 삭제됨
    - **"permanently delete"** 입력 후 삭제 진행

---

### 📝 핵심 정리

|항목|내용|
|---|---|
|**버킷 이름**|_전역 고유_, 모든 AWS 계정/리전 간 충돌 없어야 함|
|**버킷 리전**|_생성 시 지정_, 이후 변경 불가|
|**접근 권한**|기본적으로 _모든 공개 접근 차단_, 직접 허용하거나 서명된 URL 필요|
|**폴더 구조**|실제 디렉토리 아님 → *키 접두사(prefix)*로 표현됨|
|**파일 업로드 제한**|최대 _5TB_, 5GB 초과는 _멀티파트 업로드_ 필수|
|**미리 서명된 URL**|_일시적 액세스_ 허용, 자격 증명 포함되어 있어 보안 유지 가능|

---

## 3. S3 보안 : 버킷정책
---

### 🧠 Amazon S3 보안의 핵심 구조

S3 보안은 크게 **사용자 기준 보안(IAM 정책)**과 **리소스 기준 보안(S3 버킷 정책, ACL)**으로 나뉜다.

---

### ✅ 사용자 기준 보안: IAM 정책

💡 **IAM 정책의 역할**

- _어떤 API를 어떤 IAM 사용자 또는 역할이 호출할 수 있는가_를 정의
- 사용자의 권한을 세밀히 제어할 수 있음

💡 **EC2와 IAM 역할**

- EC2 인스턴스가 S3에 접근할 경우 **IAM 사용자 대신 IAM 역할** 사용
- EC2에 역할을 할당하고 S3 접근 권한 포함 시, 인스턴스에서 S3 API 호출 가능

---

### ✅ 리소스 기준 보안

#### 1. 🔐 S3 버킷 정책

- **S3 보안의 중심** 기능
- JSON 형식의 정책 문서로 작성
- S3 콘솔에서 설정 가능

**버킷 정책 구성 요소**

|요소|설명|
|---|---|
|`"Resource"`|정책이 적용될 버킷 또는 오브젝트 경로 (`"arn:aws:s3:::examplebucket/*"` 등)|
|`"Effect"`|`Allow` 또는 `Deny` – 요청 허용/거부|
|`"Action"`|허용 또는 거부할 S3 API 목록 (예: `s3:GetObject`)|
|`"Principal"`|정책이 적용될 사용자, 계정 등 (`"*"`이면 모두 허용)|

💡 **예시 정책 설명**

```json
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::examplebucket/*"
}
```

→ examplebucket에 있는 **모든 오브젝트를 누구나 읽을 수 있도록 허용**  
→ 퍼블릭 접근 설정

🧠 **교차 계정 액세스(Cross-account Access)**

- 다른 AWS 계정의 사용자에게 접근 권한 부여 가능
- 버킷 정책에서 특정 계정의 사용자만 허용하도록 설정 가능

#### 2. 📄 Access Control List (ACL)

- 오래된 방식, 객체 단위까지 세부 권한 설정 가능
- 현재는 **비활성화**하는 경우가 많음
- _버킷 ACL_도 있지만 일반적으로 잘 사용하지 않음

---

### 🔐 S3 오브젝트 암호화

💡 오브젝트 저장 시 암호화 가능

- **SSE (Server-Side Encryption)** 방식
- 자체 키 또는 KMS 키 사용 가능

---

### ⚠️ 퍼블릭 접근 차단 설정

✅ **퍼블릭 접근 차단(Public Access Block)** 기능

- 실수로 퍼블릭 액세스를 허용하지 않도록 보호
- S3 버킷 정책이 퍼블릭이라도 **이 설정이 활성화되면 접근 불가**
- **버킷 단위** 또는 **계정 전체 단위**로 설정 가능

🛡 기업 데이터 유출 방지를 위한 안전 장치  
→ 버킷을 공개할 필요가 없다면 **항상 활성화 추천**

---

### ✅ S3 접근 조건 요약

- 접근 가능 조건:
    - IAM 정책 또는 S3 리소스 정책에서 명시적으로 **Allow**
    - 명시적 **Deny**가 없어야 함

---

### 💡 정리

- S3 보안 = **IAM 정책 + S3 버킷 정책 + ACL (선택적) + 암호화 + 퍼블릭 접근 차단**
- **퍼블릭 접근은 신중히**, 차단 설정을 적극 활용
- **정책 구조와 적용 대상 명확히 이해**하는 것이 핵심

---
## 4. Amazon S3 버킷 정책 실습 : 커피 파일을 Public으로 만들기
---

### 🧠 실습 목표

- S3 버킷 내 특정 오브젝트(`Coffee.jpg`)에 대해 **공용 URL 접근 허용**
    
- 이를 위해 **버킷 정책 작성 및 적용** + **퍼블릭 접근 차단 해제** 과정 실습
    

---

### ✅ 단계별 실습 요약

#### 1. 🔧 퍼블릭 접근 차단 해제

- S3 버킷 → **[권한 탭]** → **퍼블릭 접근 차단 설정 편집**
    
- 모든 체크 해제 (→ 공용 접근 허용)
    
- ⚠️ _이 작업은 매우 위험하며, **실제 데이터에 적용 시 보안 사고 유의**_  
    → 실습 또는 퍼블릭 콘텐츠에만 사용해야 함
    

#### 2. 🛠 버킷 정책 생성 및 적용

- **버킷 정책 영역으로 이동** → 비어 있음
    
- **정책 생성기(Policy Generator)** 사용:
    
    - 서비스: S3
        
    - 효과: Allow
        
    - Principal: `*` (모든 사용자 허용)
        
    - 액션: `s3:GetObject`
        
    - 리소스: `arn:aws:s3:::버킷이름/*` ← 슬래시 뒤 별표 `*`는 **모든 오브젝트 대상**
        

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::example-bucket-name/*"
    }
  ]
}
```

- 이 정책은 해당 버킷의 **모든 객체를 누구나 읽을 수 있도록 허용**
    

#### 3. ✅ 정책 적용 후 저장

- 정책 복사 → 버킷 정책 입력란에 붙여넣기
    
- **불필요한 공백 제거** 후 저장
    

---

### 🔍 결과 확인

- **`Coffee.jpg` 오브젝트로 이동** → **객체 URL 복사**
    
- 브라우저에 붙여넣으면 이미지 확인 가능  
    → 퍼블릭 접근이 성공적으로 설정된 것
    

---

### ⚠️ 주의사항 정리

- 공용 접근은 _퍼블릭 접근 차단 설정 해제 + 정책 설정_ 두 가지가 모두 필요
    
- **보안 상 매우 민감한 설정**이므로 실습 또는 공개 콘텐츠 외에는 피해야 함
    
- 잘못된 설정을 방지하기 위해 AWS는 퍼블릭 접근 차단 기능을 제공함
    

---

### 🧠 요약 정리

| 설정 항목        | 설명                                   |
| ------------ | ------------------------------------ |
| 퍼블릭 접근 차단 해제 | 권한 탭에서 설정                            |
| 버킷 정책 적용     | 정책 생성기로 JSON 생성 후 붙여넣기               |
| Principal    | `*` → 누구나 접근 허용                      |
| Action       | `s3:GetObject` → 객체 읽기 허용            |
| Resource     | `arn:aws:s3:::버킷명/*` → 버킷 내 모든 객체 대상 |
| 확인 방법        | 오브젝트 URL을 브라우저에서 열어보기                |

---

## 5.  Amazon S3로 정적 웹사이트 호스팅하기
---
### 🧠 핵심 개념 요약

Amazon S3는 **정적 웹사이트 호스팅** 기능을 제공합니다.  
즉, S3 버킷을 이용해 **HTML, CSS, 이미지 파일 등**을 웹에서 접근 가능한 형태로 제공할 수 있습니다.

---

### ✅ 정적 웹사이트 호스팅 흐름

1. **S3 버킷 생성**
    
    - 버킷 이름은 **도메인처럼 고유해야 함** (예: `my-static-site`)
        
2. **웹 파일 업로드**
    
    - HTML, CSS, 이미지 파일 등 정적 콘텐츠 업로드
        
3. **정적 웹 호스팅 활성화**
    
    - 버킷 → **속성 탭** → 정적 웹사이트 호스팅 설정
        
    - **인덱스 문서** (`index.html`) 및 오류 문서 설정
        
4. **퍼블릭 접근 허용**
    
    - 웹 사용자들이 버킷 파일에 접근할 수 있어야 하므로
        
    - **퍼블릭 읽기 권한**을 부여하는 **S3 버킷 정책** 필요
        
5. **웹사이트 URL 확인**
    
    - 생성된 URL은 리전마다 다름  
        예:
        
        ```
        http://<버킷이름>.s3-website-<리전>.amazonaws.com  
        http://<버킷이름>.s3-website.<리전>.amazonaws.com
        ```
        
    - 💡 **대시(`-`)와 점(`.`)** 의 차이는 리전에 따라 URL 형태가 달라지는 것일 뿐, 기억할 필요는 없음
        

---

### ⚠️ 403 Forbidden 오류가 날 때

- 퍼블릭 접근 권한이 **정상적으로 설정되지 않은 경우** 발생
    
- 해결 방법:
    
    - **퍼블릭 접근 차단 설정 해제**
        
    - **버킷 정책**에 `s3:GetObject` 권한 부여
        

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicRead",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::your-bucket-name/*"
    }
  ]
}
```

---

### 🧠 요약 정리

|항목|설명|
|---|---|
|호스팅 대상|정적 웹사이트 (HTML, 이미지 등)|
|필수 설정|정적 웹 호스팅 활성화 + 퍼블릭 읽기 허용|
|접근 URL|리전에 따라 다름 (예: `s3-website-<리전>`)|
|퍼블릭 설정 누락 시|`403 Forbidden` 오류 발생|

---
## 6. 🌐 Amazon S3 정적 웹사이트 호스팅 실습
---
### 🧠 목표

- S3 버킷에 **정적 웹사이트 호스팅 기능 활성화**
    
- HTML, 이미지 파일 업로드 후 **웹 브라우저에서 직접 확인**
    
- 퍼블릭 접근 정책을 활용해 **공개 접근 가능한 사이트 완성**
    

---

### ✅ 실습 순서 요약

#### 1. 📁 파일 업로드

- `coffee.jpg`, `beach.jpg` 업로드 완료
    
- 이후 **웹사이트 메인 페이지 역할의 `index.html`** 업로드
    

#### 2. ⚙️ 정적 웹사이트 호스팅 설정

- S3 버킷 → **[속성 탭]** → 하단의 **정적 웹사이트 호스팅** 설정
    
- **편집 → 정적 웹사이트 활성화**
    
    - 호스팅 타입: `정적 웹사이트`
        
    - 인덱스 문서: `index.html`
        

💡 _index.html은 **홈 페이지** 역할_  
→ 업로드가 안 되어 있다면 설정만 해도 웹사이트는 작동하지 않음

#### 3. 🔓 퍼블릭 접근 설정 (이전 강의에서 설정 완료)

- **퍼블릭 접근 차단 해제**
    
- **S3 버킷 정책에 읽기 권한 설정**
    

```json
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::your-bucket-name/*"
}
```

→ 모든 웹 사용자에게 버킷 내 파일을 읽을 수 있도록 허용

#### 4. 🌍 웹사이트 확인

- 설정 완료 후, **정적 웹사이트 엔드포인트 URL 생성됨**
    
- URL 접속 시 `index.html`의 내용 표시됨
    
    - 예: "I love coffee", "Hello World", 이미지 포함
        
- 이미지 URL 변경 테스트:
    
    - `coffee.jpg` → `beach.jpg`로 변경하면 바다 사진 표시됨
        
    - URL 직접 입력하여 테스트 가능
        

---

### 🧠 실습 결과 정리

|항목|상태|
|---|---|
|정적 웹사이트 호스팅|활성화 완료|
|index.html 업로드|완료|
|이미지 파일 업로드|`coffee.jpg`, `beach.jpg` 업로드됨|
|퍼블릭 읽기 권한|정책 적용 완료|
|웹사이트 작동 확인|성공 – 이미지와 HTML 렌더링 정상 동작|

---

### ✅ 체크포인트

- S3에서 정적 웹사이트를 호스팅할 때는 **정적 웹 호스팅 활성화 + 퍼블릭 읽기 권한**이 필수
    
- **index.html**은 반드시 업로드되어야 함
    
- 버킷 엔드포인트는 브라우저에서 접근 가능한 URL 형태로 제공됨
    

---
## 7.  🔁 Amazon S3 버전 관리(Versioning) 요약
---
### 🧠 핵심 개념

Amazon S3는 **버킷 단위로 버전 관리 기능**을 제공합니다.  
이 기능을 통해 **동일한 키(파일 이름)를 가진 오브젝트의 여러 버전**을 저장하고 관리할 수 있습니다.

---

### ✅ S3 버전 관리란?

- **버킷 단위 설정**: 버킷마다 버전 관리 기능을 **활성화해야 사용 가능**
    
- **버전 생성 방식**: 같은 키(파일명)로 새로운 파일 업로드 시 **기존 파일은 보존되고 새 버전 추가**
    
- **모든 파일은 고유한 Version ID**를 갖게 됨 (버전 미사용 시 `null`)
    

---

### 💡 왜 사용하는가?

#### 1. 🔐 데이터 보호

- 실수로 **파일을 덮어쓰거나 삭제했을 때도 복구 가능**
    
- 삭제 시 실제 삭제되지 않고 **Delete Marker**만 생성됨
    

#### 2. ⏳ 버전 복원 (롤백)

- 이전 버전으로 **손쉽게 되돌리기 가능**
    
    - 예: "2일 전 버전으로 되돌리기"
        

#### 3. 🧱 안전한 업데이트

- 정적 웹사이트 업데이트 시도 중에도 **기존 버전은 항상 유지**
    
- 안정성과 복구 가능성 확보
    

---

### ⚠️ 유의사항

| 항목             | 설명                                        |
| -------------- | ----------------------------------------- |
| 버전 관리 활성화 전 파일 | 버전 ID = `null`                            |
| 기능 비활성화 후에도    | 기존 버전들은 **보존됨** (삭제되지 않음)                 |
| 스토리지 비용        | 모든 버전을 저장하므로 **비용 증가 유의**                 |
| 삭제 방식          | 실제 삭제하려면 **모든 버전과 Delete Marker를 제거**해야 함 |
|                |                                           |

---

### 🛠 콘솔에서 버전 관리 활성화하기

1. S3 버킷 선택
    
2. **[속성 탭] → 버전 관리(Versioning)** 설정
    
3. **편집 → 버전 관리 활성화 후 저장**
    

→ 이후 동일 파일을 업로드할 때마다 새 버전이 생성됨  
→ **각 버전은 S3 콘솔에서 확인 및 복원 가능**

---

### ✅ 요약 정리

|기능|설명|
|---|---|
|버전 관리 활성화|버킷 단위 설정|
|주요 효과|실수 방지, 롤백, 변경 이력 보존|
|복구 방법|콘솔에서 이전 버전 선택 → 복원|
|버전 ID|각 파일 버전마다 고유한 ID (버전 관리 전 파일은 `null`)|

---
## 8.